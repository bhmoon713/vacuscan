<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Vacuscan — Stage Console</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root {
    --bg:#0d1117; --card:#161b22; --muted:#30363d; --text:#e6edf3; --accent:#58a6ff; --ok:#3fb950; --bad:#f85149;
  }
  * { box-sizing: border-box; }
  body { margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Apple Color Emoji,Noto Color Emoji; background:var(--bg); color:var(--text); }
  header { display:flex; gap:12px; align-items:center; padding:14px 16px; border-bottom:1px solid var(--muted); }
  header h1 { font-size:18px; margin:0 8px 0 0; font-weight:600; letter-spacing:.3px; }
  .row { display:grid; grid-template-columns: 1.2fr 1fr; gap:14px; padding:16px; }
  .card { background:var(--card); border:1px solid var(--muted); border-radius:14px; padding:14px; }
  .card h2 { font-size:15px; margin:0 0 10px; font-weight:600; }
  .controls { display:grid; grid-template-columns: repeat(12, 1fr); gap:8px; align-items:end; }
  label { font-size:12px; color:#9da7b3; display:block; margin-bottom:6px; }
  input[type=text], input[type=number], select {
    width:100%; padding:9px 10px; color:var(--text); background:#0f141a; border:1px solid var(--muted); border-radius:10px;
  }
  button {
    padding:10px 12px; background:#1f6feb; border:none; color:#fff; border-radius:10px; cursor:pointer; font-weight:600;
  }
  button.ghost { background:#0f141a; border:1px solid var(--muted); color:var(--text); }
  button.warn { background:var(--bad); }
  button.ok { background:var(--ok); }
  button:disabled { opacity:.5; cursor:not-allowed; }
  .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
  .kpis { display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
  .kpi { background:#0f141a; border:1px solid var(--muted); border-radius:10px; padding:10px; }
  .kpi .label { font-size:12px; color:#9da7b3; }
  .kpi .value { font-size:18px; font-weight:700; margin-top:4px; }
  .log { height:180px; overflow:auto; font-family:ui-monospace, SFMono-Regular, Menlo, monospace; background:#0b0f14; border:1px dashed var(--muted); border-radius:10px; padding:10px; }
  .flex { display:flex; gap:10px; align-items:center; }
  .tag { font-size:11px; padding:4px 8px; border:1px solid var(--muted); border-radius:999px; }
  canvas { width:100%; height:240px; display:block; background:#0f141a; border:1px solid var(--muted); border-radius:10px; }
  .hint { color:#9da7b3; font-size:12px; margin-top:6px; }
</style>
</head>
<body>
<header>
  <h1>Vacuscan — Stage Console</h1>
  <div class="flex" style="gap:8px;">
    <label>
      <span style="display:block;font-size:11px;color:#9da7b3;margin-bottom:4px;">rosbridge URL</span>
      <input id="wsUrl" type="text" value="ws://localhost:9090" style="width:270px;">
    </label>
    <button id="btnConnect">Connect</button>
    <button id="btnDisconnect" class="ghost" disabled>Disconnect</button>
    <span id="connState" class="tag">disconnected</span>
  </div>
</header>

<div class="row">
  <!-- Motion -->
  <section class="card">
    <h2>Motion</h2>
    <div class="controls" style="margin-bottom:10px;">
      <div style="grid-column: span 2;">
        <label>Go to X (mm)</label>
        <input id="gotoX" type="number" step="0.1" value="0">
      </div>
      <div style="grid-column: span 2;">
        <label>Go to Y (mm)</label>
        <input id="gotoY" type="number" step="0.1" value="0">
      </div>
      <div style="grid-column: span 2;">
        <label>&nbsp;</label>
        <button id="btnGoto" disabled>Go to</button>
      </div>
      <div style="grid-column: span 1;">
        <label>Jog step</label>
        <select id="jogStep">
          <option value="1">1 mm</option>
          <option value="5">5 mm</option>
          <option value="10">10 mm</option>
        </select>
      </div>
      <div style="grid-column: span 2;">
        <label>Soft limits</label>
        <div class="flex">
          <input id="limMin" type="number" step="1" value="-200" style="width:100px;">&nbsp;to&nbsp;
          <input id="limMax" type="number" step="1" value="200" style="width:100px;"> mm
        </div>
      </div>

      <div style="grid-column: span 12;" class="grid-2">
        <div class="flex" style="gap:8px; flex-wrap:wrap;">
          <button id="jogXm" class="ghost" disabled>◀ X−</button>
          <button id="jogXp" class="ghost" disabled>X+ ▶</button>
          <button id="jogYm" class="ghost" disabled>▼ Y−</button>
          <button id="jogYp" class="ghost" disabled>Y+ ▲</button>
          <button id="btnHome" class="ghost" disabled>Home (0,0)</button>
        </div>
        <div class="kpis">
          <div class="kpi"><div class="label">X (mm)</div><div id="kpiX" class="value">—</div></div>
          <div class="kpi"><div class="label">Y (mm)</div><div id="kpiY" class="value">—</div></div>
          <div class="kpi"><div class="label">X (µm)</div><div id="kpiXum" class="value">—</div></div>
          <div class="kpi"><div class="label">Y (µm)</div><div id="kpiYum" class="value">—</div></div>
        </div>
      </div>
    </div>
    <div class="hint">
      Service: <code>/wafer/goto</code> (WaferGoto).  
      Subscribed: <code>/wafer/pose</code> (geometry_msgs/msg/Pose2D).
    </div>
  </section>
</div>

<!-- Waypoints -->
<section class="card" style="margin:0 16px 16px;">
  <h2>Waypoints</h2>

  <!-- Put controls + action log in same row -->
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">

    <!-- LEFT: Waypoint Controls -->
    <div>
      <div class="controls">

        <div style="grid-column: span 3;">
          <label>Route</label>
          <select id="wpRoute">
            <!-- <option value="calibration">calibration</option>
            <option value="warming_up">warming_up</option>
            <option value="scan_E5CA">scan_E5CA</option>
            <option value="scan_HBM4">scan_HBM4</option> -->
            <option value="scan_from_grid">scan_from_grid</option>
            
          </select>
        </div>

        <div style="grid-column: span 2;">
          <label>Tolerance (mm)</label>
          <input id="wpTol" type="number" step="1" value="50">
        </div>

        <div style="grid-column: span 2;">
          <label>Timeout (s)</label>
          <input id="wpTimeout" type="number" step="0.1" value="10">
        </div>

        <div style="grid-column: span 2;">
          <label>Pause (s)</label>
          <input id="wpPause" type="number" step="0.1" value="0.5">
        </div>

        <div style="grid-column: span 2;">
          <label>Loop</label>
          <select id="wpLoop">
            <option value="false">off</option>
            <option value="true">on</option>
          </select>
        </div>

        <div style="grid-column: span 1;">
          <label>&nbsp;</label>
          <button id="btnRunRoute" class="ok" disabled>Run</button>
        </div>

        <div style="grid-column: span 1;">
          <label>&nbsp;</label>
          <button id="btnStopRoute" class="warn" disabled>Abort</button>
        </div>

      </div>
    </div>

    <!-- RIGHT: Action Log + Progress -->
    <div>
      <div class="mb-3">
        <label class="form-label fw-bold" style="color:#ccc;">Route Progress</label>
        <div class="progress" style="height: 22px; background:#333;">
          <div id="route-progress-bar"
              class="progress-bar progress-bar-striped progress-bar-animated"
              role="progressbar"
              style="width: 0%; background:#4caf50;">
            0%
          </div>
        </div>
      </div>
      <h2 style="margin-top:0;">Action Status</h2>
      <div style="height: 260px; overflow-y: auto; background:#0b0f14; 
                  border:1px dashed var(--muted); border-radius:10px; padding:10px;">
        <pre id="action_log" style="color:#0f0; font-size:14px; margin:0;"></pre>
      </div>
    </div>

  </div>

  <div class="hint" style="margin-top:10px;">
    Services: <code>/wafer/run_waypoints</code> (RunWaypoints),
    <code>/wafer/abort_waypoints</code> (Trigger).  
    Subscribed: <code>/wafer/route_progress</code>, <code>/wafer/route_total</code>.
  </div>
</section>

<section class="card" style="margin:0 16px 16px;">
  <h2>Event Log</h2>
  <div id="log" class="log"></div>
</section>

<!-- Load roslib first, then your app -->
<script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>
<script src="./app.js"></script>
</body>
</html>